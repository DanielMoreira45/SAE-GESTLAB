{% extends 'consult_base.html' %}
{% block styles %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/gerer_utilisateurs.css')}}">
{% endblock %}
{% block content %}
<h1>Gérer les utilisateurs</h1>
<div class="main">
    <div class="user">
        <section>
            {% for user in liste_users %}
            <div class="user_item">
                <img src="{{ url_for('static', filename='images/user.png') }}" alt="Un utilisateur">
                <input type="button" value="{{user.nom}} {{user.prenom}}" class="user_bouton" id="{{ user.id }}"
                    onclick="edit(this.id)">
            </div>
            {% endfor %}
        </section>
    </div>
    <div class="user_infos">
        <section>
            <div class="nom_prenom">
                <label for="nom">Nom :</label>
                <input id="nom" type="text" value="{{ current_user.nom }}">
                <label for="prenom">Prénom :</label>
                <input id="prenom" type="text" value="{{ current_user.prenom }}">
            </div>
            <div class="psswd_role">
                <label for="passwd">Mot de passe :</label>
                <input id="password" type="password" value="{{ current_user.password }}">
                <label for="role-select">Rôle :</label>
                <select name="roles" id="role-select">
                    <option value="Administrateur">Administrateur</option>
                    <option value="Professeur">Professeur</option>
                    <option value="Etablissement">Etablissement</option>
                </select>
                <label class="droits_modif">Droits de modification</label>
                <div class="button_modify">
                    <input type="radio" name="choice" id="yes_choice">
                    <label for="yes_choice">Oui</label>
                    <input type="radio" name="choice" id="no_choice">
                    <label for="no_choice">Non</label>
                </div>
            </div>
            <button type="submit" id="save_button">Enregistrer</button>
        </section>
    </div>
</div>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        var firstUserButton = document.querySelector(".user_bouton");
        if (firstUserButton) {
            var userId = firstUserButton.getAttribute("id");
            edit(userId);
        }
    });

    function edit(id) {
        var inputNom = document.getElementById("nom");
        var inputPrenom = document.getElementById("prenom");
        var inputPassword = document.getElementById("password");
        var selectRole = document.getElementById("role-select");
        var droitModif = document.getElementsByName("choice");
        
        fetch('/get_user_info/' + id)
            .then(response => response.json())
            .then(data => {
                inputNom.value = data.nom;
                inputPrenom.value = data.prenom;
                inputPassword.value = data.password;
                selectRole.value = data.role;
                if (data.modifications === true){
                    var droit = document.getElementById("yes_choice");
                    droit.checked = true;
                }
                else{
                    var droit = document.getElementById("no_choice");
                    droit.checked = true;
                }
            })
            .catch(error => console.error('Erreur : ' + error));
    }
</script>
{% endblock %}